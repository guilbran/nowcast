# read files
base<-read.csv2('./outros/factor122807.2.csv')
legend<-read.csv2('./outros/Legend.csv')
giannoneetal2008 <- list(Base = base,Legenda = legend)

save(giannoneetal2008,file = 'giannoneetal2008.rda')


# Transformation vector
trans <- legends$Transformation

# Regressors matrix time serie
dates<-as.Date(as.character(base[-1.1]),'%d/%m/%Y')

gdp<-basets[,dim(basets)[2]]

x<-Bpanel(basets,trans)

now<-nowcast(gdp,basets[,-dim(basets)[2]],trans[-length(trans)])

now$main

now$factors$C

now$factors$A

xmat <-read.xlsx('./outros/dados_matlab.xslx',sheetIndex = 1)

covmat<-read.xlsx('./outros/covmatlab.xlsx',sheetIndex = 1,header = F)

sum((covR-covmat)>10^-14)


x[1:293,-1] - as.numeric(xmat[1:293,])

x0<-x[,'IPMINE']
y0<-basets[,'IPMINE']
y00<-na.omit(diff(y0)/lag(y0,-1))

outlier <- abs(y00 - median(y00, na.rm = T)) > 4*abs(quantile(y00, probs = 0.25, na.rm = T) -  quantile(y00, probs = 0.75, na.rm = T))
sum(outlier)

round2 = function(x, n) {
  posneg = sign(x)
  z = abs(x)*10^n
  z = z + 0.5
  z = trunc(z)
  z = z/10^n
  z*posneg
}
TT<-length(na.omit(y0))
outlier <- abs(y00 - sort(y00)[round(TT*1/2)]) > 4*abs(sort(y00)[round2(TT*1/4,0)] -  sort(y00)[round2(TT*3/4,0)])

outlier




x1<-c(
  0.448296270803949,
  2.95399635453742,
  4.46667160903848,
  6.64795160610815,
  6.63807572188809,
  4.41997605531919,
  5.36612512588479,
  6.17328601974944,
  8.89999847251544,
  5.46401254038388,
  5.55485390694725,
  6.77766640784989,
  9.95702155927271,
  8.29410119663231,
  5.37001167280468,
  -1.45533992307865,
  -5.02962562095345,
  -9.08500765459431,
  -7.82856439615169,
  -5.44135077688104,
  -2.81204975882259,
  1.44893635351080,
  1.65571470725497,
  2.10358584116290,
  -1.32494252350320,
  -2.99875316931461,
  -3.71900747198215,
  -1.92734766206819,
  -0.972746757583564,
  -0.148077748254010,
  -0.101665628103425,
  0.991552223352230,
  -3.41136205797743,
  -11.0125772265804,
  -17.8327538327823,
  -18.9647390123712,
  -13.9552233967926,
  -10.3794609305828,
  -7.35418509369897,
  -6.52799849558664,
  -2.72725804418152,
  1.47345213528161,
  4.68859594691962,
  4.62662848790976,
  3.15428195340501,
  1.84734001720842,
  1.08752939265173,
  2.07397168190794,
  2.43049747216981,
  5.83216868377530,
  7.44128979115970,
  10.0587557162921,
  8.44532945665944,
  6.88319182671719,
  2.47475076157690,
  -0.422347637791883,
  -2.12805607349906,
  -0.366578844171351,
  1.77731776135184,
  2.31571347206338,
  1.55987366804402,
  0.138433988031754,
  -1.65398709028257,
  -2.84195777583045,
  -3.90934727056265,
  -1.88015680686473,
  -1.11310455431661,
  -1.77994005846378,
  -3.84592022465782,
  -2.54968590872098,
  2.61073783886053,
  5.00547043405796,
  2.44667339907644,
  -1.62408108300435,
  -2.00882713536823,
  -0.263703440309680,
  0.548375919109949,
  -2.57225151162238,
  -0.114897100636913,
  1.19440272551291,
  6.79515212881104,
  3.14895374020583,
  1.49838308278574,
  -1.18980425087597,
  0.0325190512312412,
  0.474646134338473,
  0.984123843936941,
  1.86058381587751,
  2.75104416849811,
  0.634044362783847,
  -2.87790671209200,
  -3.91418130769750,
  -1.98653974296494,
  -0.0815545130236131,
  -2.23173598970071,
  -4.03095480759828,
  -4.67705599183000,
  -3.52152526644740,
  -3.51273480509284,
  -2.62924319464655,
  -2.42068638680652,
  -1.83600725877865,
  -2.26333470505564,
  -2.43358390470635,
  -3.07731632888373,
  -2.19183945612869,
  0.0267700118251231,
  1.23867089975997,
  0.975307203298661,
  -1.54002539483335,
  -1.22386104706986,
  -1.58607419844947,
  0.980235229295677,
  1.29140728820928,
  1.39642509906585,
  -0.518264525835631,
  -2.55217928975691,
  -3.10259496222702,
  -2.60868504024533,
  0.339814016829327,
  1.37980418487844,
  1.78492843770807,
  0.237339211510125,
  2.43520873353524,
  4.57054125565874,
  6.32040553829817,
  3.42889735028911,
  1.22387747713370,
  0.661196001883431,
  2.38512883047911,
  3.27406871277143,
  1.79412767411929,
  0.944741075397998,
  -0.136713810731984,
  -0.407744552379917,
  -1.76345131967105,
  -1.82212488370802,
  0.857970257348608,
  3.34757595652051,
  4.03705487555251,
  -0.556396864782364,
  -3.29410144206109,
  -4.56209016564069,
  -1.40485228600643,
  0.858132921366702,
  1.00926724029847,
  1.14629390094113,
  -1.18310128281387,
  0.439863488093835,
  -0.657440423774181,
  -0.215335354096714,
  -1.47297566818070,
  -0.157028504207171,
  4.32298395116715,
  6.10606436736725,
  7.07051144287523,
  4.11725726591469,
  3.61796979914991,
  1.50968798243297,
  0.664589244575859,
  -0.852293647340273,
  -1.46073678001676,
  -1.84524702618385,
  0.191273439429873,
  3.04889318703369,
  4.99120314443694,
  3.74929403190392,
  0.856468365271343,
  -0.216977201922881,
  -1.14696743072234,
  0.564285539863021,
  0.473807455503347,
  0.952442087116618,
  -0.672535691996988,
  1.47279080153098,
  3.45541582619252,
  4.25223222761672,
  0.0374587316423423,
  -2.54547968795736,
  -3.73650786973160,
  -4.22054848544171,
  -6.27300687368851,
  -8.13218982294239,
  -7.99954762329338,
  -7.19859391003647,
  -6.65730889006775,
  -6.47267171595049,
  -7.41552379645687,
  -5.52481432500727,
  -5.08724228762368,
  -3.00084943008076,
  -2.69072798838805,
  0.130549981392286,
  2.04703044090032,
  2.83370240637011,
  1.89873719269062,
  2.43153820406268,
  4.65891385526789,
  5.59234784153610,
  4.28648415628980,
  1.78542764741998,
  0.881381684925542,
  0.232799855204946,
  -0.364327280968226,
  0.114443855582426,
  1.86230029081647,
  2.45999966942972,
  2.43883346657430,
  0.821959426958152,
  0.215055405373312,
  -1.44760480043056,
  -0.102133127570719,
  1.90965155478227,
  4.69149325316477,
  4.20806281479096,
  2.16787021908073,
  -0.747429866713928,
  -2.64848977409097,
  -2.31902921525467,
  -1.69093022163075,
  -1.43157667182353,
  -3.66978575668246,
  -5.85397105105419,
  -7.13445222280958,
  -7.33646195052219,
  -6.31547686841551,
  -4.41849232663970,
  -1.17294929369099,
  0.547146004315291,
  0.337523823923213,
  -3.07356868514221,
  -5.26399636341567,
  -4.92022161951583,
  0.333299717789870,
  4.29895165827932,
  5.13807072512755,
  2.16406949852714,
  0.261362403619694,
  -1.46771445485388,
  -1.79910252776491,
  -2.39775872999559,
  -0.849405575866889,
  0.714094852637598,
  2.25209005386643,
  2.15989544890605,
  0.838845628825230,
  -0.0442879290485815,
  -1.00875023151819,
  -0.489980787950938,
  -1.50709074639557,
  -0.800298452098048,
  -1.88836600527230,
  -0.180720509436544,
  -0.711008151691658,
  -2.18659433612025,
  -5.44243516389050,
  -3.86351154748243,
  2.50280214236927,
  7.23836288187597,
  7.54933656614426,
  3.81310204117186,
  2.11641248842181,
  -0.800052269427736,
  -0.991547329764557,
  -2.48038206109311,
  -1.94618086821135,
  -12.7977976014050,
  -21.4206686355973,
  -24.1758911395920,
  -5.08918089067937,
  13.8821438218043,
  21.5139646328062,
  15.1564921373354,
  6.83143143847872,
  5.06114315407609,
  5.73251456788247,
  5.89629314676745,
  2.97247487875803,
  0.470501392796305,
  -0.849680736840807,
  0.712656671268732,
  2.21166338963874,
  1.58456197694960,
  0.185571415415191,
  -3.58810217349340,
  -2.89595134774500,
  -2.44886330071802,
  0.0508984315287585,
  1.13463752517090,
  1.93066573698161,
  3.77081156774237,
  3.15093775098946,
  4.84791802982149,
  NaN,
  NaN,
  NaN,
  NaN,
  NaN,
  NaN,
  NaN,
  NaN,
  NaN,
  NaN,
  NaN,
  NaN,
  NaN,
  NaN,
  NaN
)

X<-cbind(x0,x1)[1:293,]
ts.plot(X,col=1:2)


diferentes <- (X[,1]-X[,2])^2 > 10^-10





